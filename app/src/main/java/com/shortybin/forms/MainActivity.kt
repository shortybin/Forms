package com.shortybin.forms

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.view.View
import android.widget.LinearLayout
import com.shortybin.form.JWFormGroupView
import com.shortybin.form.bean.FormBean

class MainActivity : AppCompatActivity() {
    lateinit var result: FormBean

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        val content_view = findViewById<LinearLayout>(R.id.linear_view)
        val json =
            "{\n" + "  \"title\": \"参会信息报名数据表单\",\n" + "  \"description\": \"会展报名的表单的介绍哦\",\n" + "  \"style\": [],\n" + "  \"modules\": [\n" + "    {\n" + "      \"id\": 1,\n" + "      \"required\": true,\n" + "      \"full_module\": true,\n" + "      \"display\": true,\n" + "      \"editable\": true,\n" + "      \"value\": \"\",\n" + "      \"field\": \"nickname\",\n" + "      \"label\": \"参会人\",\n" + "      \"placehold\": \"请输入您的真实姓名\",\n" + "      \"tips\": \"请确保工作人员可以联系到您\",\n" + "      \"engine\": {\n" + "        \"name\": \"simpleText\",\n" + "        \"config\": {\n" + "          \"length\": 8\n" + "        }\n" + "      },\n" + "      \"regx_list\": [\n" + "        {\n" + "          \"id\": 13,\n" + "          \"expression\": \"/[一-龥豈-鶴]/\",\n" + "          \"error_message\": \"包含无效字符\"\n" + "        }\n" + "      ],\n" + "      \"resource\": [],\n" + "      \"style\": []\n" + "    },\n" + "    {\n" + "      \"id\": 2,\n" + "      \"required\": true,\n" + "      \"full_module\": true,\n" + "      \"display\": true,\n" + "      \"editable\": true,\n" + "      \"value\": \"\",\n" + "      \"field\": \"phone\",\n" + "      \"label\": \"联系电话\",\n" + "      \"placehold\": \"请输入您的手机号\",\n" + "      \"tips\": \"请确保工作人员可以联系到您\",\n" + "      \"engine\": {\n" + "        \"name\": \"simpleText\",\n" + "        \"config\": {\n" + "          \"length\": 13\n" + "        }\n" + "      },\n" + "      \"regx_list\": [\n" + "        {\n" + "          \"id\": 23,\n" + "          \"expression\": \"/^1[34578]\\\\d{9}\$/\",\n" + "          \"error_message\": \"手机号不符合格式\"\n" + "        }\n" + "      ],\n" + "      \"resource\": [],\n" + "      \"style\": []\n" + "    },\n" + "    {\n" + "      \"id\": 3,\n" + "      \"required\": true,\n" + "      \"full_module\": true,\n" + "      \"display\": true,\n" + "      \"editable\": true,\n" + "      \"value\": \"否\",\n" + "      \"field\": \"join_school_meeting\",\n" + "      \"label\": \"参加校友会\",\n" + "      \"placehold\": \"\",\n" + "      \"tips\": \"参加校友会需要填写学校和活动类型哦\",\n" + "      \"engine\": {\n" + "        \"name\": \"radio\",\n" + "        \"config\":{\n" + "\n" + "        }\n" + "      },\n" + "      \"regx_list\": [],\n" + "      \"resource\": [\n" + "        {\n" + "          \"id\": 23,\n" + "          \"title\": \"选项是否\",\n" + "          \"type\": 1,\n" + "          \"api_setting\": null,\n" + "          \"options\": [\n" + "            {\n" + "              \"label\": \"是\",\n" + "              \"value\": \"是\",\n" + "              \"event\": {\n" + "                \"event_type\": \"display_on\",\n" + "                \"link_module\": [\n" + "                  4,\n" + "                  5\n" + "                ]\n" + "              }\n" + "            },\n" + "            {\n" + "              \"label\": \"否\",\n" + "              \"value\": \"否\"\n" + "            }\n" + "          ]\n" + "        }\n" + "      ],\n" + "      \"style\": []\n" + "    },\n" + "    {\n" + "      \"id\": 4,\n" + "      \"required\": false,\n" + "      \"full_module\": true,\n" + "      \"display\": false,\n" + "      \"editable\": true,\n" + "      \"value\": \"\",\n" + "      \"field\": \"attendee_in\",\n" + "      \"label\": \"校友会活动\",\n" + "      \"placehold\": \"请选择您想要参加的活动\",\n" + "      \"tips\": \"每人最多参加2项\",\n" + "      \"engine\": {\n" + "        \"name\": \"select\",\n" + "        \"config\": {\n" + "          \"max\": 3,\n" + "          \"searchable\": true,\n" + "          \"multi\": true\n" + "        }\n" + "      },\n" + "      \"regx_list\": [],\n" + "      \"resource\": [\n" + "        {\n" + "          \"id\": 121,\n" + "          \"title\": \"2021峰会校友会活动列表\",\n" + "          \"type\": 2,\n" + "          \"api_setting\": {\n" + "            \"uri\": \"https://www.fastmock.site/mock/532e60f1fc8ce344d5709c8f022f5cc7/api/school/attendee\",\n" + "            \"list_key\": \"data\",\n" + "            \"label_key\": \"label\",\n" + "            \"value_key\": \"value\",\n" + "            \"children_key\": \"\"\n" + "          },\n" + "          \"options\": []\n" + "        }\n" + "      ],\n" + "      \"style\": []\n" + "    },\n" + "    {\n" + "      \"id\": 5,\n" + "      \"required\": false,\n" + "      \"full_module\": true,\n" + "      \"display\": false,\n" + "      \"editable\": true,\n" + "      \"value\": \"\",\n" + "      \"field\": \"school\",\n" + "      \"label\": \"毕业院校\",\n" + "      \"placehold\": \"请选择您的毕业院校\",\n" + "      \"tips\": \"目前仅支持本地的院校哦\",\n" + "      \"engine\": {\n" + "        \"name\": \"select\",\n" + "        \"config\": {\n" + "          \"max\": 1,\n" + "          \"searchable\": true,\n" + "          \"multi\": false\n" + "        }\n" + "      },\n" + "      \"regx_list\": [],\n" + "      \"resource\": [\n" + "        {\n" + "          \"id\": 121,\n" + "          \"title\": \"2021峰会校友会活动列表\",\n" + "          \"type\": 2,\n" + "          \"api_setting\": {\n" + "            \"uri\": \"https://www.fastmock.site/mock/532e60f1fc8ce344d5709c8f022f5cc7/api/school\",\n" + "            \"list_key\": \"data\",\n" + "            \"label_key\": \"label\",\n" + "            \"value_key\": \"value\",\n" + "            \"children_key\": \"\"\n" + "          },\n" + "          \"options\": []\n" + "        }\n" + "      ],\n" + "      \"style\": []\n" + "    },\n" + "    {\n" + "      \"id\": 6,\n" + "      \"required\": false,\n" + "      \"full_module\": true,\n" + "      \"display\": true,\n" + "      \"editable\": true,\n" + "      \"value\": \"\",\n" + "      \"field\": \"school\",\n" + "      \"label\": \"选择类型\",\n" + "      \"placehold\": \"请选择您的毕业院校\",\n" + "      \"tips\": \"目前仅支持本地的院校哦\",\n" + "      \"engine\": {\n" + "        \"name\": \"checkbox\",\n" + "        \"config\": {\n" + "          \"max\": 1,\n" + "          \"searchable\": true,\n" + "          \"multi\": false\n" + "        }\n" + "      },\n" + "      \"regx_list\": [],\n" + "      \"resource\": [\n" + "        {\n" + "          \"id\": 121,\n" + "          \"title\": \"2021峰会校友会活动列表\",\n" + "          \"type\": 1,\n" + "          \"api_setting\": {\n" + "            \"uri\": \"https://www.fastmock.site/mock/532e60f1fc8ce344d5709c8f022f5cc7/api/school\",\n" + "            \"list_key\": \"data\",\n" + "            \"label_key\": \"label\",\n" + "            \"value_key\": \"value\",\n" + "            \"children_key\": \"\"\n" + "          },\n" + "          \"options\": [\n" + "            {\n" + "              \"label\": \"测试1\",\n" + "              \"value\": \"1\"\n" + "            },\n" + "            {\n" + "              \"label\": \"测试2\",\n" + "              \"value\": \"2\"\n" + "            },\n" + "            {\n" + "              \"label\": \"测试3\",\n" + "              \"value\": \"3\"\n" + "            }\n" + "          ]\n" + "        }\n" + "      ],\n" + "      \"style\": []\n" + "    }\n" + "  ]\n" + "}"

        result = JsonHelper.getObjectByStr(json, FormBean::class.java)

        result.modules.forEach {
            val formGroupView = JWFormGroupView(this).apply {
                tag = it.id
                boxView = content_view
                setData(it)
                if (!it.display) {
                    visibility = View.GONE
                }
            }
            content_view.addView(formGroupView)
        }
    }
}